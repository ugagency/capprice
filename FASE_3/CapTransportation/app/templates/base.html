<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ title or "Cap Transportation" }}</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=2">
</head>

<body class="bg-light" data-page="{{ page|default('mestre') }}">
  <div class="d-flex vh-100">

    <!-- SIDEBAR -->
    <aside class="sidebar border-end bg-white d-flex flex-column">
      <!-- LOGO -->
      <div class="p-4 border-bottom">
        <div class="d-flex align-items-center gap-2">
          <div class="brand-badge">CT</div>
          <div>
            <div class="fw-bold text-uppercase lh-1">CAP TECH</div>
            <div class="text-muted small">TRANSPORTATION</div>
          </div>
        </div>
      </div>

      <!-- MENU -->
      <div class="p-3">
        <div class="text-uppercase text-muted small fw-bold mb-2">OPERAÇÃO</div>

        <a data-perm="mestre"
           class="navlink {% if active_tab=='mestre' %}active{% endif %}"
           href="{{ url_for('main.mestre') }}">
          Visão Mestre
        </a>

        <a data-perm="comercial"
           class="navlink {% if active_tab=='comercial' %}active{% endif %}"
           href="{{ url_for('main.comercial') }}">
          Comercial
        </a>

        <a data-perm="programacao"
           class="navlink {% if active_tab=='programacao' %}active{% endif %}"
           href="{{ url_for('main.programacao') }}">
          Programação
        </a>

        <a data-perm="industrial"
           class="navlink {% if active_tab=='industrial' %}active{% endif %}"
           href="{{ url_for('main.industrial') }}">
          Industrial
        </a>

        <a data-perm="laboratorio"
           class="navlink {% if active_tab=='laboratorio' %}active{% endif %}"
           href="{{ url_for('main.laboratorio') }}">
          Laboratório
        </a>

        <a data-perm="faturamento"
           class="navlink {% if active_tab=='faturamento' %}active{% endif %}"
           href="{{ url_for('main.faturamento') }}">
          Faturamento
        </a>
      </div>

      <!-- LOGOUT -->
      <div class="mt-auto p-3">
        <div class="d-grid">
          <!-- Redireciona direto para o login do CAPSSYS -->
          <a href="http://localhost:5018/"
             class="btn btn-outline-danger btn-sm">
            Sair
          </a>
        </div>
      </div>
    </aside>

    <!-- CONTEÚDO -->
    <main class="flex-grow-1 d-flex flex-column overflow-hidden">
      <header class="border-bottom bg-white px-4 py-3 d-flex justify-content-between align-items-center">
        <div>
          <div class="text-muted small">Dashboard</div>
          <div class="fw-bold">{{ title or "Visão Mestre" }}</div>
        </div>
      </header>

      <section class="p-4 overflow-auto">
        {% block content %}{% endblock %}
      </section>
    </main>
  </div>

  <!-- CONTEXTO FRONTEND -->
  <script>
    window.__BOOT__ = {
      permissions: {{ (permissions or {}) | tojson }},
      me: {
        email: {{ (user.get("email") if user else "") | tojson }},
        name:  {{ (user.get("name") if user else "") | tojson }}
      }
    };
  </script>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- CONTROLE DE PERMISSÕES -->
  <script src="{{ url_for('static', filename='js/pages/nav-permissions.js') }}?v=1"></script>

  <!-- JS PRINCIPAL -->
  <script type="module"
          src="{{ url_for('static', filename='js/main.js') }}?v=2"></script>
</body>
</html>
